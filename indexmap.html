<!DOCTYPE HTML>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7" />
    <title>TO WangZi!</title>
    <style type="text/css">
body,div,dl,dt,dd,ul,ol,li,h1,h2,h3,h4,h5,h6,pre,form,fieldset,input,textarea,p,blockquote,th,td { 
    margin:0;
    padding:0;
}
table {
    border-collapse:collapse;
    border-spacing:0;
}
fieldset,img { 
    border:0;
}
address,caption,cite,code,dfn,em,strong,th,var {
    font-style:normal;
    font-weight:normal;
}
ol,ul {
    list-style:none;
}
caption,th {
    text-align:left;
}
h1,h2,h3,h4,h5,h6 {
    font-size:100%;
    font-weight:bold;
}
q:before,q:after {
    content:'';
}
abbr,acronym { border:0;
}

body, html {
    height: 100%;
    width: 100%;
}

/* Common 定义基本样式 */
body {
    font: 12px/1.8 'Microsoft Yahei','Helvetica Neue',Helvetica,Arial,Sans-serif;
    padding: 0;
    margin: 0;
    color: #333333;
}

#map {
    height: 100%;
    width: 100%;
}

#loading {
    height: 100%;
    width: 100%;
    position: absolute;
    z-index: 999;
    background: url("http://wangziluning.com/images/site/loading.gif") no-repeat center center #FFFAD1;
    top: 0;
    left: 0;
    text-align: center;
    line-height: 300px;
    font-size: 32px;
    color: #666;
}
#theEnd {
    height: 0%;
    width: 100%;
    line-height: 0;
    font-size: 0;
    overflow: hidden;
    position: absolute;
    z-index: 999;
    background-color: #FFFAD1;
    top: 0;
    left: 0;
}

#theEndText {
    position: absolute;
    left: 0;
    z-index: 9999;
    width: 100%;
    text-align: center;
    font-size: 26px;
    line-height: 2;
    top: 50%;
    margin-top: -100px;
    height: 200px;
}
    </style>
</head>
<body>
    <div id="loading">正在加载...</div>
    <div id="theEnd"></div>
    <div id="map"></div>

<!-- 指定全局的分享内容 -->
<input id="wsContent" type="hidden" value="送给王总的生日礼物 ——by 陆宁">
<!-- 指定全局的分享链接 -->
<input id="wsUrl" type="hidden" value="http://wangziluning.com/">
<!-- 指定全局的分享图片 -->
<input id="wsPic" type="hidden" value="http://wangziluning.com/images/map/map1.jpg">

<script type="text/javascript" src="http://wangziluning.com/js/jquery.min.js"></script>
<script type="text/javascript" src="http://wangziluning.com/js/jquery.wshare.js"></script>
<script type="text/javascript" src="http://wangziluning.com/sm/soundmanager2-nodebug-jsmin.js"></script>
<script type="text/javascript">
(function(a,b){"use strict";var c=function(){var a=[["requestFullscreen","exitFullscreen","fullscreenchange","fullscreen","fullscreenElement"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitfullscreenchange","webkitIsFullScreen","webkitCurrentFullScreenElement"],["mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozFullScreen","mozFullScreenElement"]];for(var c=0,d=a.length;c<d;c++){var e=a[c];if(e[1]in b)return e}}();if(!c)return a.screenfull=!1;var d="ALLOW_KEYBOARD_INPUT"in Element,e={init:function(){return b.addEventListener(c[2],function(a){e.isFullscreen=b[c[3]],e.element=b[c[4]],e.onchange(a)}),this},isFullscreen:b[c[3]],element:b[c[4]],request:function(a){a=a||b.documentElement,a[c[0]](d&&Element.ALLOW_KEYBOARD_INPUT),b.isFullscreen||a[c[0]]()},exit:function(){b[c[1]]()},toggle:function(a){this.isFullscreen?this.exit():this.request(a)},onchange:function(){}};a.screenfull=e.init()})(window,document)
</script>
<script type="text/javascript">

/*
 * 常用变量
 */
// 初始化地图中心
var MP_CEN = {lng: 3.894763, lat: 44.529534};
// 中国中心
var CN_CEN = {lng: 103.758427, lat: 36.172333};
// 石湫影视基地
var SQ_JD = {lng: 118.914376, lat: 31.658409};
// 北门桥馄饨摊
var BMQ_HTT = {lng: 118.793902, lat: 32.054968};
// 60家 118.79377,32.053792
var LN_HOME = {lng: 118.79377, lat: 32.053792};
// 南京市中心 118.790572,32.047996
var JS_NJC = {lng: 118.790572, lat: 32.047996};
// 第一个中心 118.860855,31.854299
var F_CENTER = {lng: 118.860855, lat: 31.854299};
// 第二个中心 118.79381,32.054205
var S_CENTER = {lng: 118.79381, lat: 32.054205};
// 背景音乐
var MUSIC;

function zoomTo(zoom, time, callback, point) {
    var time     = time || 1000;
    var callback = callback || function() {};
    var loop     = '';
    function loopZoom() {
        var curZoom  = map.getZoom();
        if( curZoom == zoom ) {
            clearTimeout(loop);
            callback();
            return false;
        }
        var plus    = curZoom > zoom ? -1 : 1;
        var toZoom  = curZoom + plus;
        map.setZoom(toZoom);
        if( point ) {
            map.setCenter(point);
        }
        var center = map.getCenter();
        loop = setTimeout(loopZoom, time);
    }
    loopZoom();
}

function loopWin(loopList, time, callback) {
    var i    = 0;
    var len  = loopList.length;
    var callback = callback || function () {};
    var timeout = '';

    function loopWinInner() {
        if( i == len ) {
            clearTimeout(timeout);
            setTimeout(callback, 1000);
            return false;
        }

        var opts = {
            title: loopList[i].title,
            maxWidth: 600,
            height: 0
        }
        var infoWindow = new BMap.InfoWindow(loopList[i].content, opts);
        map.openInfoWindow(infoWindow, new BMap.Point(loopList[i].point.lng, loopList[i].point.lat));
        infoWindow.redraw();
        i++;
        if( loopList[i] ) {
            var time = loopList[i].timeout || 2500;
        } else {
            var time = 2500;
        }
        timeout = setTimeout(loopWinInner, time);
    }

    loopWinInner();
}

function panZoom_GTC() {
    map.panTo(new BMap.Point(BMQ_HTT.lng, BMQ_HTT.lat));
    setTimeout(function() {
        zoomTo(18, 800, function() {
            var marker = new BMap.Marker(BMQ_HTT);
            map.addOverlay(marker);
            marker.setAnimation(BMAP_ANIMATION_BOUNCE);
            setTimeout(panZoom_JYU, 1000);
        }, BMQ_HTT);
    }, 800);
}

function panZoom_JYU() {
    zoomTo(8, 1000, function() {
        map.panTo(new BMap.Point(SQ_JD.lng, SQ_JD.lat));
        setTimeout(function() {
            zoomTo(16, 800, function() {
                var marker = new BMap.Marker(SQ_JD);
                map.addOverlay(marker);
                marker.setAnimation(BMAP_ANIMATION_BOUNCE);
                setTimeout(panZoom_HEY, 1000);
            });
        }, 1000);
    });
}

function panZoom_HEY() {
    zoomTo(11, 1000, function() {
        map.panTo(new BMap.Point(F_CENTER.lng, F_CENTER.lat));
        setTimeout(function() {
            var start = new BMap.Point(SQ_JD.lng, SQ_JD.lat);
            var end   = new BMap.Point(BMQ_HTT.lng, BMQ_HTT.lat);
            var driving2 = new BMap.DrivingRoute(map, {renderOptions:{map: map, autoViewport: false}});
            driving2.search(start, end);
            setTimeout(function() {
                var between = [
                    {
                        title: '第一次约会',
                        content: '王总出发的地方（石湫影视基地）',
                        point: SQ_JD
                    },
                    {
                        title: '北门桥柴火馄饨',
                        content: '初次见面的地方',
                        point: BMQ_HTT
                    }
                ];
				loopWin(between, 2000, panLNHOME);
            }, 2000);
        }, 1000);
    });
}

function panLNHOME() {
    zoomTo(19, 1000, function() {
        map.panTo(new BMap.Point(S_CENTER.lng, S_CENTER.lat));
        setTimeout(function() {
            var start = new BMap.Point(LN_HOME.lng, LN_HOME.lat);
            var end   = new BMap.Point(BMQ_HTT.lng, BMQ_HTT.lat);
            var driving2 = new BMap.DrivingRoute(map, {renderOptions:{map: map, autoViewport: false}});
            driving2.search(start, end);
            setTimeout(function() {
                var between = [
					{
                        title: '第一次约会',
                        content: '我出发的地方',
                        point: LN_HOME
                    },
                    {
                        title: '北门桥柴火馄饨',
                        content: '初次见面的地方',
                        point: BMQ_HTT
                    },
                    {
                        title: '这是一切的开始！',
                        content: '<img src="http://wangziluning.com/images/Picture006.jpg" width="352" height="374" alt="馄饨摊" />',
                        point: BMQ_HTT
                    }
                ];
                loopWin(between, 2000, showHuangShan);
            }, 2000);
        }, 1000);
    });
}

function showHuangShan() {
    map.clearOverlays();
    map.panTo(new BMap.Point(118.176916,30.134073));
    setTimeout(function() {
        zoomTo(13, 1000, function() {
            var hsphotos = [
                {
                    title: '黄山之行',
                    content: '<img src="http://wangziluning.com/images/huangshan1.jpg" width="410" height="308" alt="黄山之行" />',
                    point: {lng: 118.188624, lat: 30.122458}
                },
                {
                    title: '黄山之行',
                    content: '<img src="http://wangziluning.com/images/huangshan2.jpg" width="461" height="346" alt="黄山之行" />',
                    point: {lng: 118.176263, lat: 30.143448}
                },
                {
                    title: '黄山之行',
                    content: '<img src="http://wangziluning.com/images/huangshan3.jpg" width="378" height="502" alt="黄山之行" />',
                    point: {lng: 118.167352, lat: 30.122208}
                },
                {
                    title: '黄山之行',
                    content: '<img src="http://wangziluning.com/images/huangshan5.jpg" width="367" height="507" alt="黄山之行" />',
                    point: {lng: 118.171377, lat: 30.153441}
                },
                {
                    title: '黄山之行',
                    content: '<img src="http://wangziluning.com/images/huangshan6.jpg" width="372" height="279" alt="黄山之行" />',
                    point: {lng: 118.176916, lat: 30.134073}
                }
            ];
            loopWin(hsphotos, 3000, showHongKong);
        });
    }, 1000);
}

function showHongKong() {
    map.clearOverlays();
    map.panTo(new BMap.Point(114.130932,22.415522));
    setTimeout(function() {
        zoomTo(12, 1000, function() {
            var hkphotos = [
                {
                    title: '香港之行',
                    content: '<img src="http://wangziluning.com/images/Hongkong1.jpg" width="255" height="448" alt="香港之行" />',
                    point: {lng: 114.121159, lat: 22.490342}
                },
                {
                    title: '香港之行',
                    content: '<img src="http://wangziluning.com/images/Hongkong2.jpg" width="284" height="428" alt="香港之行" />',
                    point: {lng: 114.192448, lat: 22.309636}
                },
                {
                    title: '香港之行',
                    content: '<img src="http://wangziluning.com/images/HongKong3.jpg" width="372" height="279" alt="香港之行" />',
                    point: {lng: 114.19906, lat: 22.333976}
                },
                {
                    title: '香港之行',
                    content: '<img src="http://wangziluning.com/images/HongKong4.jpg" width="372" height="279" alt="香港之行" />',
                    point: {lng: 114.19906, lat: 22.333976}
                },
                {
                    title: '香港之行',
                    content: '<img src="http://wangziluning.com/images/HongKong5.jpg" width="372" height="279" alt="香港之行" />',
                    point: {lng: 114.19906, lat: 22.333976}
                }
            ];
            loopWin(hkphotos, 3000, showHangZhou);
        });
    }, 1000);
}

function showHangZhou() {
    map.clearOverlays();
    map.panTo(new BMap.Point(120.175681,30.279955));
    setTimeout(function() {
        zoomTo(12, 1000, function() {
            var hzphotos = [
                {
                    title: '杭州之行',
                    content: '<img src="http://wangziluning.com/images/hangzhou1.jpg" width="468" height="266" alt="杭州之行" />',
                    point: {lng: 120.157859, lat: 30.264485}
                },
                {
                    title: '杭州之行',
                    content: '<img src="http://wangziluning.com/images/hangzhou2.jpg" width="496" height="279" alt="杭州之行" />',
                    point: {lng: 120.190054, lat: 30.268477}
                },
                {
                    title: '杭州之行',
                    content: '<img src="http://wangziluning.com/images/hangzhou3.jpg" width="449" height="335" alt="杭州之行" />',
                    point: {lng: 120.170507, lat: 30.230042}
                },
                {
                    title: '杭州之行',
                    content: '<img src="http://wangziluning.com/images/hangzhou4.jpg" width="294" height="379" alt="杭州之行" />',
                    point: {lng: 120.21995, lat: 30.292928}
                },
                {
                    title: '杭州之行',
                    content: '<img src="http://wangziluning.com/images/hangzhou5.jpg" width="373" height="279" alt="杭州之行" />',
                    point: {lng: 120.134862, lat: 30.257497}
                },
                {
                    title: '杭州之行',
                    content: '<img src="http://wangziluning.com/images/hangzhou6.jpg" width="313" height="419" alt="杭州之行" />',
                    point: {lng: 120.151535, lat: 30.248013}
                },
                {
                    title: '王总我要坐船！',
                    content: '<img src="http://wangziluning.com/images/hangzhou7.jpg" width="434" height="326" alt="王总我要坐船！" />',
                    point: {lng: 120.163608, lat: 30.256}
                },
                {
                    title: '杭州行这张脸出现在你曾经大学的附近是不是很不真实？哈哈哈',
                    content: '<img src="http://wangziluning.com/images/Picture080.jpg" width="372" height="278" alt="wannaTo" />',
                    point: {lng: 120.348771, lat: 30.325154}
                }
            ];
            loopWin(hzphotos, 3000, wannaTo);
        });
    }, 1000);
}

function wannaTo() {
    map.closeInfoWindow();
    zoomTo(14, 1000, function() {
        map.panTo(new BMap.Point(JS_NJC.lng, JS_NJC.lat));
        //map.setMapType(BMAP_HYBRID_MAP);
        setTimeout(function() {
            var wanna = [
                {
                    title: '',
                    content: '我们的记忆',
                    point: JS_NJC
                },
                {
                    title: '先卖个萌~',
                    content: '<img src="http://wangziluning.com/images/Picture001.jpg" width="256" height="341" alt="wannaTo" />',
                    point: {lng: 118.772545, lat: 32.015569}
                },
                {
                    title: '你妹！就知道躲后面！',
                    content: '<img src="http://wangziluning.com/images/Picture005.jpg" width="308" height="231" alt="wannaTo" />',
                    point: {lng: 118.82806, lat: 31.949977}
                },
                {
                    title: '这是我最喜欢的一张自拍',
                    content: '<img src="http://wangziluning.com/images/Picture008.jpg" width="354" height="266" alt="wannaTo" />',
                    point: JS_NJC
                },
                {
                    title: '偶尔虐你一下，拿你当苦力',
                    content: '<img src="http://wangziluning.com/images/Picture009.jpg" width="288" height="384" alt="wannaTo" />',
                    point: {lng: 118.787515, lat: 32.048502}
                },
                {
                    title: '这些胡桃夹子是我给你的第一个惊喜吧',
                    content: '<img src="http://wangziluning.com/images/Picture014.jpg" width="288" height="384" alt="wannaTo" />',
                    point: {lng: 118.794014, lat: 32.054241}
                },
                {
                    title: '刚认识的时候动不动就咬我',
                    content: '<img src="http://wangziluning.com/images/Picture016.jpg" width="373" height="280" alt="wannaTo" />',
                    point: LN_HOME
                },
                {
                    title: '这个我能跳过嘛。本命年你送我的，结果本命年刚过没几天就弄丢了',
                    content: '<img src="http://wangziluning.com/images/Picture018.jpg" width="288" height="384" alt="wannaTo" />',
                    point: LN_HOME
                },
                {
                    title: '第一次去你家，你笑的那么开心，我脸那么肥。。。',
                    content: '<img src="http://wangziluning.com/images/Picture021.jpg" width="240" height="320" alt="wannaTo" />',
                    point: {lng: 118.810269, lat: 31.948724}
                },
                {
                    title: '偷吃被发现只能切个爱心草莓求原谅',
                    content: '<img src="http://wangziluning.com/images/Picture028.jpg" width="371" height="279" alt="wannaTo" />',
                    point: {lng: 118.794014, lat: 32.054241}
                },
                {
                    title: '跑到江边吹江风。',
                    content: '<img src="http://wangziluning.com/images/Picture030.jpg" width="329" height="186" alt="wannaTo" />',
                    point: {lng: 118.823277, lat: 32.153146}
                },
                {
                    title: '一起骚绿去郊游',
                    content: '<img src="http://wangziluning.com/images/Picture034.jpg" width="212" height="374" alt="wannaTo" />',
                    point: {lng: 118.787515, lat: 32.048502}
                },
                {
                    title: '哎哟我去，怎么还有这图',
                    content: '<img src="http://wangziluning.com/images/Picture036.jpg" width="372" height="279" alt="wannaTo" />',
                    point: {lng: 118.787515, lat: 32.048502}
                },
                {
                    title: '第六个一百天',
                    content: '<img src="http://wangziluning.com/images/Picture038.jpg" width="360" height="270" alt="wannaTo" />',
                    point: JS_NJC
                },
                {
                    title: '骑行仙林时霸气的你',
                    content: '<img src="http://wangziluning.com/images/Picture043.jpg" width="288" height="384" alt="wannaTo" />',
                    point: {lng: 118.916334, lat: 32.105043}
                },
                {
                    title: '这是你第一次参加我的家庭聚餐，自助餐只吃菜叶子！',
                    content: '<img src="http://wangziluning.com/images/Picture050.jpg" width="288" height="384" alt="wannaTo" />',
                    point: {lng: 118.772545, lat: 32.015569}
                },
                {
                    title: '整理了下我们的小卡片',
                    content: '<img src="http://wangziluning.com/images/Picture051.jpg" width="384" height="271" alt="wannaTo" />',
                    point: {lng: 118.79379, lat: 32.053847}
                },
                {
                    title: '你给的生日礼物',
                    content: '<img src="http://wangziluning.com/images/Picture059.jpg" width="288" height="389" alt="wannaTo" />',
                    point: JS_NJC
                },
                {
                    title: '比比谁腿美！',
                    content: '<img src="http://wangziluning.com/images/Picture064.jpg" width="217" height="384" alt="wannaTo" />',
                    point: {lng: 118.790679, lat: 32.057331}
                },
                {
                    title: '一个小手术，就算你工作那么忙，可还是天天来陪我，辛苦你了',
                    content: '<img src="http://wangziluning.com/images/Picture069.jpg" width="217" height="384" alt="wannaTo" />',
                    point: {lng: 118.79379, lat: 32.067942}
                },
                {
                    title: '你口中萌萌哒睡姿',
                    content: '<img src="http://wangziluning.com/images/Picture071.jpg" width="217" height="384" alt="wannaTo" />',
                    point: {lng: 118.794014, lat: 32.054241}
                },
                {
                    title: '王总求放过',
                    content: '<img src="http://wangziluning.com/images/Picture075.jpg" width="374" height="280" alt="wannaTo" />',
                    point: {lng: 118.780307, lat: 32.077521}
                },
                {
                    title: '18家的墙面上肯定留下不少你的罪证',
                    content: '<img src="http://wangziluning.com/images/Picture077.jpg" width="372" height="279" alt="wannaTo" />',
                    point: {lng: 118.79379, lat: 32.053847}
                }
            ];
        loopWin(wanna, 3000, showMarkerText);
        }, 2000);
    });
}

var markerText = [
    			{
                    title: '认识你之后，这是我的变化',
                    content: '<img src="http://wangziluning.com/images/Picture002.jpg" width="384" height="362" alt="wannaTo" />',
                    point: {lng: 118.859137, lat: 32.064948},
                    flag :true
                },
                {
                    title: '高跟鞋！？我没看错吧！感谢赵小猫分享的好货',
                    content: '<img src="http://wangziluning.com/images/Picture004.jpg" width="217" height="384" alt="wannaTo" />',
                    point: {lng: 118.837032, lat: 32.027686},
                    flag :true
                },
                {
                    title: '因为你告诉我他叫xx狂魔导致我再也不能正视他',
                    content: '<img src="http://wangziluning.com/images/Picture003.jpg" width="257" height="341" alt="wannaTo" />',
                    point: {lng: 118.73613, lat: 32.053126},
                    flag :true
                },
                {
                    title: '这是你第一次也是最后一次骑我给你的死飞。。。。',
                    content: '<img src="http://wangziluning.com/images/Picture031.jpg" width="281" height="373" alt="wannaTo" />',
                    point: {lng: 118.867741, lat: 32.088167},
                    flag :true
                },
                {
                    title: '一起去攀岩',
                    content: '<img src="http://wangziluning.com/images/Picture073.jpg" width="279" height="374" alt="wannaTo" />',
                    point: {lng: 118.715172, lat: 32.095972},
                    flag :true
                },
                {
                    title: '买买买！还记得我买了送给你之后你妈还吐槽我说：你干嘛买给她',
                    content: '<img src="http://wangziluning.com/images/Picture022.jpg" width="240" height="320" alt="wannaTo" />',
                    point: {lng: 118.791319, lat: 31.992881},
                    flag :true
                },
                {
                    title: '难得做成一个卖相不错的面',
                    content: '<img src="http://wangziluning.com/images/Picture023.jpg" width="279" height="373" alt="wannaTo" />',
                    point: {lng: 118.754771, lat: 32.114373},
                    flag :true
                },
                {
                    title: '那次随手折出来的，感觉你还蛮开心的',
                    content: '<img src="http://wangziluning.com/images/Picture024.jpg" width="280" height="373" alt="wannaTo" />',
                    point: {lng: 118.769698, lat: 32.093481},
                    flag :true
                },
                {
                    title: '女汉子在吃南大地锅鸡',
                    content: '<img src="http://wangziluning.com/images/Picture032.jpg" width="212" height="372" alt="wannaTo" />',
                    point: {lng: 118.849032, lat: 32.044974},
                    flag :true
                },
                {
                    title: '每当天气好的时候你都要我去帮你晒被子～',
                    content: '<img src="http://wangziluning.com/images/Picture067.jpg" width="384" height="288" alt="wannaTo" />',
                    point: {lng: 118.755753, lat: 32.028656},
                    flag :true
                },
                {
                    title: '高大上的黎巴嫩巧克力，你让我跑马拉松的时候吃',
                    content: '<img src="http://wangziluning.com/images/Picture042.jpg" width="217" height="384" alt="wannaTo" />',
                    point: {lng: 118.792737, lat: 32.081417},
                    flag :true
                },
                {
                    title: '土豪吃面',
                    content: '<img src="http://wangziluning.com/images/Picture046.jpg" width="384" height="271" alt="wannaTo" />',
                    point: {lng: 118.867953, lat: 32.108296},
                    flag :true
                },
                {
                    title: '我们下飞机时已是你生日的凌晨，你肯定没想到打开后备箱会发现蛋糕和花吧！！！',
                    content: '<img src="http://wangziluning.com/images/Picture047.jpg" width="384" height="271" alt="wannaTo" />',
                    point: {lng: 118.728634, lat: 32.111821},
                    flag :true
                },
                {
                    title: '最近的新欢姜氏烧烤',
                    content: '<img src="http://wangziluning.com/images/Picture049.jpg" width="288" height="389" alt="wannaTo" />',
                    point: {lng: 118.818422, lat: 32.010752},
                    flag :true
                },
                {
                    title: '炮筒子你抢镜了！',
                    content: '<img src="http://wangziluning.com/images/Picture074.jpg" width="373" height="279" alt="wannaTo" />',
                    point: {lng: 118.770372, lat: 32.009953},
                    flag :true
                },
                {
                    title: '这是被北京干燥的天气玩坏了的王总',
                    content: '<img src="http://wangziluning.com/images/Picture076.jpg" width="336" height="250" alt="wannaTo" />',
                    point: {lng: 118.722436, lat: 32.074606},
                    flag :true
                },
                {
                    title: '陪你去开中药，金蝉！！！',
                    content: '<img src="http://wangziluning.com/images/Picture081.jpg" width="240" height="320" alt="wannaTo" />',
                    point: {lng: 118.825402, lat: 32.094702},
                    flag :true
                },
                {
                    title: '你很喜欢这件衣服吧',
                    content: '<img src="http://wangziluning.com/images/Picture083.jpg" width="256" height="341" alt="wannaTo" />',
                    point: {lng: 118.840296, lat: 32.107629},
                    flag :true
                }
];

function addMarker(lng, lat) {
    var marker = new BMap.Marker( new BMap.Point(lng, lat) );
    map.addOverlay(marker);
    marker.setAnimation(BMAP_ANIMATION_BOUNCE);
}

if (!Array.prototype.shuffle) {
    Array.prototype.shuffle = function() {
        for(var j, x, i = this.length; i; j = parseInt(Math.random() * i), x = this[--i], this[i] = this[j], this[j] = x);
        return this;
    };
}
markerText.shuffle();
function loopAddMarker(markers, callback) {
    var i           = 0;
    var len         = markers.length;
    var callback    = callback || function() {};
    var loop        = '';
    function loopAddMarkerInner() {
        if( i == len ) {
        	map.closeInfoWindow();
        	map.panTo(new BMap.Point(118.790507,32.048055));
            clearTimeout(loop);
            setTimeout(callback(), 2000)
            return false;
        }
        
        if(markers[i].flag == true){
        	var opts = {
                    title: markers[i].title,
                    maxWidth: 600,
                    height: 0
                }
            var infoWindow = new BMap.InfoWindow(markers[i].content, opts);
            map.openInfoWindow(infoWindow, new BMap.Point(markers[i].point.lng, markers[i].point.lat));
            infoWindow.redraw();
            setTimeout(function(){ 
            	addMarker(markers[i].point.lng, markers[i].point.lat);
                i++;
                loop = setTimeout(loopAddMarkerInner, 300);
            },3000);
        }else {
        	addMarker(markers[i].point.lng, markers[i].point.lat);
            i++;
            loop = setTimeout(loopAddMarkerInner, 300);
        }
    }
    loopAddMarkerInner();
}

function showMarkerText() {
    map.closeInfoWindow();
    map.panTo(new BMap.Point(118.790507,32.048055));
    setTimeout(function() {
        zoomTo(13, 1000, function() {
            loopAddMarker(markerText, function() {
                setTimeout(function() {
                    slideDown('theEnd', 500, function() {
                        var theEndText = '<div id="theEndText">Happy birthday to my dearest WangZi  --by LuNing<br />' + 
                                         '<button data-toggle="wshare" data-type="weibo">分享到微博</button>' + 
                                         '<button onclick="window.location.reload();">再看一次</button></div>';
                        document.getElementById('theEnd').innerHTML = theEndText;
                    });
                }, 5000);
            });
        })
    }, 1000);
}

function slideDown(id, speed, callback) {
    var object  = document.getElementById(id);
    var timeout = speed*0.001;
    var callback= callback || function() {};
    var loop    = '';
    object.style.display = 'block';
    object.style.height = '0%';
    function slideDownInner() {
        var curHeight = parseFloat(object.style.height) || 0;
        if( curHeight >= 100 ) {
            clearTimeout(loop);
            callback();
            return false;
        }
        object.style.height = (curHeight + 0.1) + '%';
        loop = setTimeout(slideDownInner, timeout);
    }
    slideDownInner();
}

function preLoadImages(imagesList, callback) {
    var len     = imagesList.length;
    var i       = 0;
    var images  = {};
    var callback = callback || function() {};
    function loadImage() {
        if( i == len ) {
            callback();
            return false;
        }
        images[i]           = new Image();
        images[i].src       = imagesList[i];
        i++;
        loadImage();
    }
    loadImage();
}

var map;

function initMap() {
    map = new BMap.Map("map");
    var point = new BMap.Point(MP_CEN.lng, MP_CEN.lat);
    map.centerAndZoom(point, 4);
    map.disableDragging();
    map.disableDoubleClickZoom();
    init();
}

function init() {
    document.getElementById('loading').style.display = 'none';
    document.getElementById('theEnd').style.height = '0';
    document.getElementById('theEnd').innerHTML = '';
    map.setMapType(BMAP_NORMAL_MAP);
    var point = new BMap.Point(MP_CEN.lng, MP_CEN.lat);
    map.centerAndZoom(point, 4);
    map.clearOverlays();
    map.reset();
    MUSIC.play();
    map.panTo(new BMap.Point(BMQ_HTT.lng, BMQ_HTT.lat));
    panZoom_GTC();
}
 
function loadScript() {
  var script = document.createElement("script");
  script.src = "http://api.map.baidu.com/api?v=1.2&callback=initMap";
  document.body.appendChild(script);
}

window.onload = function() {
    var imglist = [
        'http://wangziluning.com/images/hangzhou1.jpg',
        'http://wangziluning.com/images/hangzhou2.jpg',
        'http://wangziluning.com/images/hangzhou3.jpg',
        'http://wangziluning.com/images/hangzhou4.jpg',
        'http://wangziluning.com/images/hangzhou5.jpg',
        'http://wangziluning.com/images/hangzhou6.jpg',
        'http://wangziluning.com/images/Hongkong1.jpg',
        'http://wangziluning.com/images/Hongkong2.jpg',
        'http://wangziluning.com/images/HongKong3.jpg',
        'http://wangziluning.com/images/HongKong4.jpg',
        'http://wangziluning.com/images/HongKong5.jpg',
        'http://wangziluning.com/images/huangshan1.jpg',
        'http://wangziluning.com/images/huangshan2.jpg',
        'http://wangziluning.com/images/huangshan3.jpg',
        'http://wangziluning.com/images/huangshan5.jpg',
        'http://wangziluning.com/images/huangshan6.jpg',
        'http://wangziluning.com/images/Picture001.jpg',
        'http://wangziluning.com/images/Picture002.jpg',
        'http://wangziluning.com/images/Picture003.jpg',
        'http://wangziluning.com/images/Picture004.jpg',
        'http://wangziluning.com/images/Picture005.jpg',
	'http://wangziluning.com/images/Picture006.jpg',
        'http://wangziluning.com/images/Picture007.jpg',
        'http://wangziluning.com/images/Picture008.jpg',
        'http://wangziluning.com/images/Picture009.jpg',
        'http://wangziluning.com/images/Picture031.jpg',
        'http://wangziluning.com/images/Picture014.jpg',
        'http://wangziluning.com/images/Picture016.jpg',
        'http://wangziluning.com/images/Picture073.jpg',
        'http://wangziluning.com/images/Picture018.jpg',
        'http://wangziluning.com/images/Picture021.jpg',
        'http://wangziluning.com/images/Picture022.jpg',
        'http://wangziluning.com/images/Picture023.jpg',
        'http://wangziluning.com/images/Picture024.jpg',
        'http://wangziluning.com/images/Picture030.jpg',
        'http://wangziluning.com/images/Picture028.jpg',
        'http://wangziluning.com/images/Picture032.jpg',
        'http://wangziluning.com/images/Picture034.jpg',
        'http://wangziluning.com/images/Picture067.jpg',
        'http://wangziluning.com/images/Picture036.jpg',
        'http://wangziluning.com/images/Picture038.jpg',
        'http://wangziluning.com/images/Picture042.jpg',
        'http://wangziluning.com/images/Picture043.jpg',
        'http://wangziluning.com/images/Picture046.jpg',
        'http://wangziluning.com/images/Picture047.jpg',
        'http://wangziluning.com/images/Picture049.jpg',
        'http://wangziluning.com/images/Picture050.jpg',
        'http://wangziluning.com/images/Picture051.jpg',
        'http://wangziluning.com/images/Picture059.jpg',
        'http://wangziluning.com/images/Picture064.jpg',
        'http://wangziluning.com/images/Picture069.jpg',
        'http://wangziluning.com/images/Picture071.jpg',
        'http://wangziluning.com/images/Picture074.jpg',
        'http://wangziluning.com/images/Picture075.jpg',
        'http://wangziluning.com/images/Picture076.jpg',
        'http://wangziluning.com/images/Picture077.jpg',
        'http://wangziluning.com/images/Picture079.jpg',
        'http://wangziluning.com/images/Picture080.jpg',
        'http://wangziluning.com/images/Picture081.jpg',
        'http://wangziluning.com/images/Picture083.jpg'
    ];

    soundManager.setup({
        url: 'http://wangziluning.com/sm/',
        onready: initMP3
    });

    function initMP3() {

        MUSIC = soundManager.createSound({
            id: 'mp3',
            url: './sound/I turn to you.mp3',
            onload: function() {
                preLoadImages(imglist, function() {
                    setTimeout(function() {
                        var loading = document.getElementById('loading');
                        loading.style.cursor = 'pointer';
                        loading.innerHTML = '点击开始';
                        loading.onclick = function() {
                            screenfull && screenfull.request();
                            loadScript();
                        }
                    }, 3000);
                });
            }
        });
        MUSIC.load();
    }
};
</script>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?c142366bae08a5add7c3c1ce2703b10d";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
</body>
</html>
